# EmotionAI - 高级情感智能交互插件

基于 AstrBot 的高级情感智能交互插件，为 AI 提供多维度的情感模拟和智能交互体验。

## 插件信息

**插件名称**: EmotionAI  
**作者**: 腾天  
**版本**: v2.1.0  
**兼容性**: AstrBot 框架

## 简介

EmotionAI 是一个高级情感智能交互插件，旨在为 AI 模拟一个多维度的、自主演变的内心世界。与传统的单一好感度系统不同，本插件提供了更丰富的情感维度和更智能的交互体验。

## 功能特色

### 🎭 多维情感模型
- **8种基础情感**：喜悦、信任、恐惧、惊讶、悲伤、厌恶、愤怒、期待
- **复合情感状态**：好感度、亲密度
- **动态关系系统**：从陌生人到亲密关系的渐进演变
- **智能情感分析**：自动识别主导情感和行为模式

### 🛡️ 智能管理系统
- **黑名单机制**：好感度过低时自动拉黑用户
- **排行榜功能**：查看好感度和亲密度平均值排行榜
- **个性化设置**：每个用户可以独立控制状态显示
- **管理员工具**：完整的管理员命令集

### ⚡ 性能优化
- **异步缓存系统**：使用异步锁避免阻塞事件循环
- **智能缓存策略**：排行榜和统计信息缓存减少重复计算
- **跨平台兼容**：支持任意格式的用户ID

### ⚙️ 灵活配置
- 可自定义好感度上下限
- 可调整单次好感度变化范围
- 支持会话独立模式
- 可配置管理员列表

## 配置说明

- **session_based**: 是否启用会话独立模式
- **favour_min**: 好感度最小值（达到此值将加入黑名单）
- **favour_max**: 好感度最大值
- **change_min**: 单次好感度减少最大值
- **change_max**: 单次好感度增加最大值
- **admin_qq_list**: 管理员QQ号列表

## 使用指南

### 用户命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `/好感度` | 查看当前情感状态 | `/好感度` |
| `/状态显示` | 切换是否在对话后显示状态信息 | `/状态显示` |
| `/好感排行` | 显示好感度平均值前N名用户 | `/好感排行 5` |
| `/负好感排行` | 显示好感度平均值后N名用户 | `/负好感排行 3` |
| `/情感分析` | 分析文本情感倾向 | `/情感分析 今天很开心` |
| `/缓存统计` | 查看缓存使用情况 | `/缓存统计` |

### 管理员命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `/设置好感 <用户ID> <数值>` | 设置用户好感度 | `/设置好感 123456 50` |
| `/重置好感 <用户ID>` | 重置用户好感度状态 | `/重置好感 123456` |
| `/查看好感 <用户ID>` | 查看指定用户情感状态 | `/查看好感 123456` |
| `/黑名单统计` | 查看黑名单详细信息 | `/黑名单统计` |
| `/重置插件` | 重置插件所有数据 | `/重置插件` |
| `/备份数据` | 备份插件数据 | `/备份数据` |

## 状态显示格式

当开启状态显示时，每次对话后会显示如下格式的状态信息：
【当前情感状态】
==================
好感度：23 | 亲密度：15
关系：熟人 | 趋势：好感领先
态度：中立 | 主导情感：信任
互动：12次 (频繁互动)
正面互动：66.7%

【情感维度详情】
喜悦：5 | 信任：8 | 恐惧：1 | 惊讶：3
悲伤：2 | 厌恶：0 | 愤怒：1 | 期待：5

## 黑名单机制

### 触发条件
- 当用户好感度达到配置的 `favour_min` 值时
- 自动加入黑名单

### 黑名单行为
- 黑名单中的用户与机器人交互时，会收到固定回复："您已加入黑名单，只有重置好感才可以移出黑名单。"
- 无法使用任何插件命令（除了重置好感）

### 解除黑名单
- 管理员使用 `/重置好感 <用户ID>` 命令
- 管理员使用 `/设置好感 <用户ID> <数值>` 将好感度设置为高于下限的值

## 技术特性

### 性能优化
- **异步操作**：所有缓存操作使用异步锁，避免阻塞事件循环
- **智能缓存**：排行榜和统计信息缓存，减少重复计算
- **内存管理**：合理的缓存大小和TTL设置

### 跨平台兼容
- 支持任意格式的用户ID（数字、字母、混合）
- 兼容QQ、Telegram、Discord等平台
- 保持向后兼容性

### 数据安全
- 自动保存机制，防止数据丢失
- 数据备份功能
- 异常恢复机制

## 版本历史

### v2.1.0 (当前版本)
- **性能优化**：使用异步锁替换线程锁，避免阻塞事件循环
- **缓存优化**：为排行榜和统计信息添加智能缓存
- **跨平台兼容**：移除用户ID格式限制，支持任意平台
- **代码重构**：模块化设计，职责分离，提高可维护性

### v1.1.3
- 修复黑名单实时拦截问题
- 改进重置插件功能
- 增强状态同步机制

### v1.1.2
- 修复 UnboundLocalError 错误
- 优化情感更新处理逻辑

### v1.1.1
- 修复重置好感功能
- 添加重置插件命令
- 优化状态显示逻辑

### v1.1.0
- 添加黑名单机制
- 添加排行榜功能
- 扩展配置选项
- 更新管理员命令

### v1.0.0
- 初始版本发布
- 基础情感维度系统
- 用户个性化设置

## 常见问题

### Q: 状态显示不工作怎么办？
A: 确保使用 `/状态显示` 命令开启状态显示，并且用户不在黑名单中。

### Q: 如何重置某个用户的状态？
A: 管理员可以使用 `/重置好感 <用户ID>` 命令完全重置用户状态。

### Q: 插件数据存储在哪里？
A: 插件数据存储在 `data/emotionai/` 目录下的 JSON 文件中。

### Q: 如何调整好感度变化范围？
A: 在插件配置中修改 `change_min` 和 `change_max` 参数。

### Q: 管理员命令在会话独立模式下是否正常工作？
A: 是的，管理员命令现在可以跨会话正常操作。

## 支持与反馈

如果您在使用过程中遇到问题或有改进建议，欢迎通过以下方式联系：

- 提交 GitHub Issue
- 联系插件作者

**项目仓库**: [https://github.com/tengtian3/astrbot-plugin-emotionai](https://github.com/tengtian3/astrbot-plugin-emotionai)

## 许可证

本项目采用 MIT 许可证。