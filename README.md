# astrbot-plugin-emotionai

基于 AstrBot 的高级情感智能交互插件，为 AI 提供多维度的情感模拟和智能交互体验。

## 插件信息

**插件名称**: astrbot-plugin-emotionai  
**作者**: 腾天  
**版本**: v1.1.3  
**兼容性**: AstrBot 框架

## 简介

astrbot-plugin-emotionai 是一个高级情感智能交互插件，旨在为 AI 模拟一个多维度的、自主演变的内心世界。与传统的单一好感度系统不同，本插件提供了更丰富的情感维度和更智能的交互体验。

## 功能特色

### 🎭 多维情感模型
- **8种基础情感**：喜悦、信任、恐惧、惊讶、悲伤、厌恶、愤怒、期待
- **复合情感状态**：好感度、亲密度
- **动态关系系统**：从陌生人到亲密关系的渐进演变
- **智能情感分析**：自动识别主导情感和行为模式

### 🛡️ 智能管理系统
- **黑名单机制**：好感度过低时自动拉黑用户
- **排行榜功能**：查看好感度和亲密度平均值排行榜
- **个性化设置**：每个用户可以独立控制状态显示
- **管理员工具**：完整的管理员命令集

### ⚙️ 灵活配置
- 可自定义好感度上下限
- 可调整单次好感度变化范围
- 支持会话独立模式
- 可配置管理员列表

## 配置说明

- **session_based**: 是否启用会话独立模式
- **favour_min**: 好感度最小值（达到此值将加入黑名单）
- **favour_max**: 好感度最大值
- **change_min**: 单次好感度减少最大值
- **change_max**: 单次好感度增加最大值
- **admin_qq_list**: 管理员QQ号列表

## 使用指南

### 用户命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `/好感度` | 查看当前情感状态 | `/好感度` |
| `/状态显示` | 切换是否在对话后显示状态信息 | `/状态显示` |
| `/好感排行` | 显示好感度平均值前N名用户 | `/好感排行 5` |
| `/负好感排行` | 显示好感度平均值后N名用户 | `/负好感排行 3` |

### 管理员命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `/设置好感 <用户ID> <数值>` | 设置用户好感度 | `/设置好感 123456 50` |
| `/重置好感 <用户ID>` | 重置用户好感度状态 | `/重置好感 123456` |
| `/重置插件` | 重置插件所有数据 | `/重置插件` |

## 状态显示格式

当开启状态显示时，每次对话后会显示如下格式的状态信息：

```
当前状态：
好感度：23 (亲密度：15)
关系：熟人 (好感领先)
态度：友好
主导情感：信任 (强度：25%)
互动统计：12 次 (频繁互动)
正面互动比例：66.7%
情感维度详情：
  喜悦：5 | 信任：8 | 恐惧：1 | 惊讶：3
  悲伤：2 | 厌恶：0 | 愤怒：1 | 期待：5
```

## 黑名单机制

### 触发条件
- 当用户好感度达到配置的 `favour_min` 值时
- 自动加入黑名单

### 黑名单行为
- 黑名单中的用户与机器人交互时，会收到固定回复："您已加入黑名单，只有重置好感才可以移出黑名单。"
- 无法使用任何插件命令（除了重置好感）

### 解除黑名单
- 管理员使用 `/重置好感 <用户ID>` 命令
- 管理员使用 `/设置好感 <用户ID> <数值>` 将好感度设置为高于下限的值

## 排行榜功能

### 好感排行
显示好感度和亲密度平均值最高的用户：
```
好感度平均值 TOP 10 排行榜：
1. 用户: 123456
   - 平均值: 85.5 (好感: 90, 亲密: 81)
2. 用户: 789012
   - 平均值: 72.0 (好感: 75, 亲密: 69)
...
```

### 负好感排行
显示好感度和亲密度平均值最低的用户：
```
好感度平均值 BOTTOM 10 排行榜：
1. 用户: 345678
   - 平均值: -50.0 (好感: -60, 亲密: -40)
2. 用户: 901234
   - 平均值: -25.5 (好感: -30, 亲密: -21)
...
```

## 技术特性

### 情感更新机制
AI 可以在回复中使用特殊格式更新情感状态：
```
[情感更新: joy:+2, trust:+1, favor:+1, intimacy:+1]
```

### 智能情感分析
- 自动分析文本情感倾向
- 根据情感状态生成回应风格指导
- 统计互动模式和倾向

### 数据持久化
- 所有用户数据自动保存到本地 JSON 文件
- 支持热重载配置
- 异常恢复机制

## 版本历史

### v1.1.3 (当前版本)
- **修复管理员命令会话逻辑**：管理员命令现在操作全局状态，不受会话隔离影响
- **修复互动统计判断条件**：优化正面/负面互动计数的准确性
- 提高插件在会话独立模式下的兼容性

### v1.1.2
- 修复 UnboundLocalError 错误
- 优化情感更新处理逻辑

### v1.1.1
- 修复重置好感功能
- 添加重置插件命令
- 优化状态显示逻辑

### v1.1.0
- 添加黑名单机制
- 添加排行榜功能
- 扩展配置选项
- 更新管理员命令

### v1.0.0
- 初始版本发布
- 基础情感维度系统
- 用户个性化设置

## 重要修复说明

### v1.1.3 关键修复

1. **管理员命令会话逻辑修复**
   - 问题：在会话独立模式下，管理员无法正确操作其他会话中的用户
   - 修复：管理员命令现在始终操作用户的全局状态，确保跨会话操作正常

2. **互动统计准确性修复**
   - 问题：使用 `any(emotion_updates.values())` 判断条件不准确
   - 修复：改为使用 `if emotion_updates:` 判断，确保只有确实有情感更新时才统计互动性质

## 常见问题

### Q: 状态显示不工作怎么办？
A: 确保使用 `/状态显示` 命令开启状态显示，并且用户不在黑名单中。

### Q: 如何重置某个用户的状态？
A: 管理员可以使用 `/重置好感 <用户ID>` 命令完全重置用户状态。

### Q: 插件数据存储在哪里？
A: 插件数据存储在 `data/emotionai/` 目录下的 JSON 文件中。

### Q: 如何调整好感度变化范围？
A: 在插件配置中修改 `change_min` 和 `change_max` 参数。

### Q: 管理员命令在会话独立模式下是否正常工作？
A: 是的，v1.1.3 修复了这个问题，管理员命令现在可以跨会话正常操作。

## 支持与反馈

如果您在使用过程中遇到问题或有改进建议，欢迎通过以下方式联系：

- 提交 GitHub Issue
- 联系插件作者

**项目仓库**: [https://github.com/tengtian3/astrbot-plugin-emotionai](https://github.com/tengtian3/astrbot-plugin-emotionai)

## 许可证

本项目采用 MIT 许可证。
